<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LiSA CFG Analyzer</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <a href="https://lisa-analyzer.github.io/" target="_blank" class="logo-link">
                    <img src="https://raw.githubusercontent.com/lisa-analyzer/lisa/master/logo.png" alt="LiSA Logo" class="lisa-logo">
                </a>
                <div class="header-text">
                    <h1>LiSA CFG Analyzer</h1>
                    <p class="subtitle">Interactive Control Flow Graph Analysis</p>
                </div>
            </div>
            <div class="header-actions">
                <a href="https://github.com/lisa-analyzer" target="_blank" class="btn btn--outline btn--sm github-link">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
                    </svg>
                    GitHub
                </a>
                <button id="shareResultsBtn" class="btn btn--primary btn--sm" disabled>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 8C20.2 8 22 6.2 22 4s-1.8-4-4-4-4 1.8-4 4c0 .6.1 1.2.4 1.7L9.9 8.8C9.3 8.3 8.7 8 8 8c-2.2 0-4 1.8-4 4s1.8 4 4 4c.7 0 1.3-.3 1.9-.8l4.5 3.1c-.3.5-.4 1.1-.4 1.7 0 2.2 1.8 4 4 4s4-1.8 4-4-1.8-4-4-4c-.7 0-1.3.3-1.9.8L11.6 13.7c.3-.5.4-1.1.4-1.7s-.1-1.2-.4-1.7l4.5-3.1c.6.5 1.2.8 1.9.8z"/>
                    </svg>
                    Share Results
                </button>
            </div>
        </header>

        <nav class="tab-nav">
            <button class="tab-btn active" data-tab="json-input">JSON Input</button>
            <button class="tab-btn" data-tab="graph-view" disabled>Graph View</button>
        </nav>

        <main class="tab-content">
            <!-- JSON Input Tab -->
            <div id="json-input" class="tab-panel active">
                <div class="json-input-layout">
                    <div class="input-section">
                        <div class="form-group">
                            <label for="jsonInput" class="form-label">CFG JSON Data</label>
                            <textarea 
                                id="jsonInput" 
                                class="form-control json-input" 
                                placeholder="Paste your LiSA CFG JSON here..."
                                spellcheck="false"
                            ></textarea>
                        </div>
                        
                        <div class="controls">
                            <button id="visualizeBtn" class="btn btn--primary">Visualize CFG</button>
                            <button id="clearBtn" class="btn btn--secondary">Clear</button>
                            <div class="sample-buttons">
                                <button id="loadSequentialBtn" class="btn btn--outline">Sequential Example</button>
                                <button id="loadConditionalBtn" class="btn btn--outline">Conditional Example</button>
                            </div>
                        </div>
                        
                        <div id="errorMessage" class="error-message hidden"></div>
                        <div id="successMessage" class="success-message hidden"></div>
                    </div>
                    
                    <div class="help-section">
                        <h3>About CFG Analysis</h3>
                        <p>This tool visualizes Control Flow Graphs generated by LiSA analyzer using a force-directed layout.</p>
                        <div class="help-item">
                            <h4>Main CFG Nodes</h4>
                            <p>Nodes connected by edges representing the control flow paths.</p>
                        </div>
                        <div class="help-item">
                            <h4>Edge Types</h4>
                            <p><strong>Sequential:</strong> Normal program flow<br>
                               <strong>True:</strong> Condition evaluates to true<br>
                               <strong>False:</strong> Condition evaluates to false</p>
                        </div>
                        <div class="help-item">
                            <h4>Interactive Features</h4>
                            <p>Click nodes to see detailed state information with expression highlighting. Drag nodes to reposition.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Graph View Tab -->
            <div id="graph-view" class="tab-panel">
                <div class="graph-container">
                    <div class="graph-header">
                        <h3 id="graphTitle">Control Flow Graph</h3>
                        <div class="graph-controls">
                            <button id="resetZoomBtn" class="btn btn--sm btn--outline">Reset Zoom</button>
                            <button id="toggleDetailsBtn" class="btn btn--sm btn--secondary">Show Details</button>
                        </div>
                    </div>
                    <div class="graph-legend">
                        <div class="legend-item">
                            <div class="legend-color start-node"></div>
                            <span>Start Node</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color main-node"></div>
                            <span>CFG Node</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color end-node"></div>
                            <span>End Node</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color detail-node"></div>
                            <span>Expression Detail</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color edge-sequential"></div>
                            <span>Sequential</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color edge-true"></div>
                            <span>True Branch</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color edge-false"></div>
                            <span>False Branch</span>
                        </div>
                    </div>
                    <svg id="graphSvg" class="graph-svg"></svg>
                </div>
            </div>
        </main>

        <!-- Node Details Panel -->
        <div class="details-panel hidden" id="detailsPanel">
            <div class="details-header">
                <h3>Node Details</h3>
                <button id="closePanelBtn" class="btn btn--sm btn--outline">×</button>
            </div>
            <div class="details-content" id="detailsContent">
                <!-- Details will be populated here -->
            </div>
        </div>

        <!-- Share URL Modal -->
        <div class="modal hidden" id="shareModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Share Results</h3>
                    <button id="closeModalBtn" class="btn btn--sm btn--outline">×</button>
                </div>
                <div class="modal-body">
                    <p>Copy this URL to share your CFG analysis:</p>
                    <div class="url-container">
                        <input type="text" id="shareUrl" class="form-control" readonly>
                        <button id="copyUrlBtn" class="btn btn--primary">Copy</button>
                    </div>
                </div>
            </div>
            <div class="modal-backdrop"></div>
        </div>
    </div>

    <div class="tooltip hidden" id="tooltip"></div>
    
    <script src="app.js"></script>
</body>
</html>